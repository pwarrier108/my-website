---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { getPath } from '../../../utils/pathUtils';

// Get all content for memoirs category
const essays = await getCollection('essays', ({ data }) => 
    data.category === 'memoir' && (data.status === 'published' || data.status === 'canonical')
);
const cases = await getCollection('cases', ({ data }) => 
    data.category === 'memoir' && (data.status === 'published' || data.status === 'canonical')
);
const reflections = await getCollection('reflections', ({ data }) => 
    data.category === 'memoir' && (data.status === 'published' || data.status === 'canonical')
);
const blog = await getCollection('blog', ({ data }) => 
    data.category === 'memoir' && data.status === 'published'
);

// Combine and sort by date
const allContent = [...essays, ...cases, ...reflections, ...blog].sort((a, b) => 
    b.data.date.valueOf() - a.data.date.valueOf()
);

// Format date
const formatDate = (date) => {
    return new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' }).format(date);
};
---

<BaseLayout title="Memoirs & Culture - Padmanand Warrier" currentPage="ideas">
    <div class="page-container">
        
        <h1>Memoirs & Culture</h1>
        
        <p class="section-intro">
            Stories from KREC campus life, travel memories, food and belonging, the humor in chaos, and the cultural textures that shape who we become. Narratives that connect personal history to larger patterns of meaning.
        </p>

        {allContent.length > 0 ? (
            <ul class="content-list">
                {allContent.map((item) => (
                    <li class="content-item">
                        <h3 class="content-item-title">
                            <a href={getPath(`/ideas/memoirs/${item.slug}`)}>{item.data.title}</a>
                        </h3>
                        <div class="metadata">
                            <span class="metadata-item">
                                <span class="metadata-label">{item.data.type.charAt(0).toUpperCase() + item.data.type.slice(1)}</span>
                            </span>
                            <span class="metadata-item">Published {formatDate(item.data.date)}</span>
                            {item.data.era && (
                                <span class="metadata-item">Era: {item.data.era}</span>
                            )}
                            {item.data.themes && item.data.themes.length > 0 && (
                                <span class="metadata-item">
                                    Themes: {item.data.themes.join(', ')}
                                </span>
                            )}
                        </div>
                        <p class="content-item-summary">{item.data.summary}</p>
                    </li>
                ))}
            </ul>
        ) : (
            <p>Content coming soon.</p>
        )}

    </div>
</BaseLayout>
